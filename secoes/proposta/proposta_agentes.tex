\section{AGENTES INTELIGENTES}

Uma vez que o funcionamento da plataforma de SMA está garantido pelo componente, os agentes modelados na arquitetura correspondente já podem ser instanciados e começar a atuar no ambiente. A ferramenta de orquestração permite o sensoriamento do seu ambiente interno para seus nodos de gerência, fato este que garante aos agentes a capacidade de observar os recursos do ambiente, uma vez que a plataforma encontra-se instanciada nestes nodos.

Embora seja garantido aos agentes um ambiente para atuarem e uma arquitetura para estarem contidos, estes ainda precisam ser instanciados. Esse processo, na técnologia JADE usada neste trabalho, deve ser feito em tempo de execução ou através de parâmetros na inicialização de um dado \texit{container}. No âmbito desta proposta ambos são usados para garantir que tanto o componente de gerência de agentes quanto o restante da ferramenta de orquestração não precisem ativamente preocuparem-se com a inicialização dos agentes. Este tópico é discutido em detalhes na subseção de inicialização dos agentes.

%TODO: LUCAS, coloque a descrição da metodologia Prometheus e tudo que tem que vir antes dos modelos dos agentes aqui!!

\subsection{INICIALIZAÇÃO DOS AGENTES}

Para que a plataforma de SMA instanciada neste módulo possa funcionar corretamente, além de ter seu ciclo de vida garantido, ela deve poder garantir o ciclo de vida de seus agentes. A própria plataforma é capaz de garantir que os agentes contidos dentro de um \textit{container} executarão enquanto esse nodo existir. No entanto, é necessário prever o caso onde um desses nodos apresente falhas e precise ser desalocado. No caso citado, cabe a aplicação o ato de reinstancia-los. Além disso, essa garantia que é dada aos agentes não deve violar a modularidade do componente em relação ao resto da plataforma, sendo assim é responsabilidade do próprio módulo garantir a criação e execução correta dos agentes. Para que esses sejam inicializados e mantenham-se vivos durante o tempo que for preciso é necessário um componente para avaliar a necessidade de um agente no ambiente.

Do modo que é projetado o acoplamento da plataforma e a ferramenta de orquestração, ambos não conhecem a existência um do outro. Dessa forma a ferramenta de orquestração não consegue exprimir sua necessidade de um agente ou sociedade de agentes para a plataforma de SMA. Sendo assim o novo componente tem não só a responsabilidade de instanciar agentes, mas também de representar as necessidades da ferramenta de orquestração em relação aos agentes e a quantidade destes que precisam estar ativos no ambiente orquestrado dependendo de seu estado atual. Para que essa tarefa seja executada, este componente deve sensoriar e atuar no ambiente de forma a atingir seu objetivo. Devido as características de suas ações e seu objetivo, este componente é modelado na forma de um agente deliberativo, chamado de agente inspetor da plataforma.

Para fins deste trabalho, o agente inspetor é responsável apenas por instânciar os agentes oriundos de \citeonline{gabriel}. Estes são detalhados nesta seção e são:

\begin{enumerate}
	\item Agente de alistamento de cluster: responsável por monitorar o ambiente de CN e listar os cluster que precisão ser trabalhados;
	\item Agente diligente do cluster: tem a função de aplicar uma heurística sobre os clusters que são marcados para serem trabalhados;
	\item Agente de alocação de cluster: é o componente responsável por ligar clusters desligados previamente para que possa atender a demandas crescentes.
\end{enumerate}

Estes três agentes compõem a sociedade que o agente inspetor conhece. De forma a mapear as necessidades da ferramenta de orquestração, é disponibilizado um artefato no qual o agente inspetor pode usar para conhecer as necessidades do ambiente e seu tamanho. Sendo assim, esse pode derivar desse conhecimento o momento que são necessários e a quantidade de cada agente dessa sociedade. 

\subsubsection{AGENTE INSPETOR DA PLATAFORMA}

O agente inspetor da plataforma deve existir enquanto houver uma instância da arquitetura de SMA ativa. Dada essa característica, este inspetor é inicializado com os \textit{main containers} da plataforma através de parâmetros na inicialização dessa. Com essa abordagem, este agente tem seu próprio ciclo de vida garantido pelo fato de que os nodos principais da plataforma contém redundância, mantendo-se ativos com cópias para atuar como nodo principal na falha do \textit{main container} corrente. O inspetor da plataforma tem como responsabilidade tanto instânciar os agentes para a ferramenta de orquestração quanto decidir se o ambiente ainda precisa deles. Caso seja notado que um determinado agente não seja mais necessário, é responsabilidade do inspetor terminar a execução desse.

Deve-se notar que um agente responsável por analisar as necessidades de uma ferramenta de orquestração e instanciar todos os agentes requisitados, rapidamente pode ficar complexo e demonstrar baixa capacidade de escalar com o restante da solução. Uma resposta a esse fenômeno é especializar o inspetor para que cada especialização expresse uma necessidade específica da ferramenta de orquestração e sua utilidade seja gerenciar apenas a sociedade de agentes necessária para suprir essa demanda específica, mantendo a inicialização destes junto dos \textit{main containers}. Embora não seja o objetivo deste trabalho lidar com este problema específico, essa observação se faz necessária pois pode tornar-se um problema em ambientes que desejam delegar muitas funções de gerência para o SMA.  

A intenção do agente inspetor da plataforma é fazer com que a ferramenta de orquestração tenha todo os agentes que deseja ativos até que a necessidade desta mude. É cargo deste agente sensoriar tanto ambiente da plataforma de SMA quanto obter informações sobre os requisitos da ferramenta de orquestração. O cruzamento desses dados é responsável por gerar as principais crenças deste agente, que motivado por elas deve adotar um plano para concretizar sua intenção. Este agente é bem definido dentro de um modelo cognitivo e intencional, onde precisa tomar decisões e manter um estado interno composto de crenças referentes a como seu ambiente encontra-se em um dado momento, deliberando não só sobre suas percepções, mas também sobre suas vontades.

Sendo esse um agente de meta gerência, seus objetivos diferem do restante da sociedade em relação ao domínio de sua atuação. Para simplificar a visualização do restante da sociedade de agentes, este agente é modelado de forma separada, de modo que todas as atribuições, percepções e funcionalidades desse sub-sistema competem a ele apenas. Seguindo a metodologia \texit{Prometheus}, baseada em teoria de agentes, podemos decompor este sistema em funcionalidades, percepções, objetivos e ações. %TODO WIP

\subsection{MODELO DOS AGENTES}
Visando a adaptação do agente proposto por \citeonline{gabriel} para a plataforma multiagente proposta neste trabalho, foram levantados os passsos envolvidos no processo de gerenciamento, sendo eles:

\begin{itemize}
	\item Selecionar um \textit{cluster} para ser gerenciado;
	\item Marcar o \textit{cluster} selecionado como sendo trabalhado;
	\item Realizar as operações de gerenciamento sobre o \textit{cluster};
	\item Marcar o \textit{cluster} como gerenciado;
	\item Verificar a disponibilidade de resursos suficientes;
	\item Disponibilizar novos recursos quando necessário.
\end{itemize}

Tendo em vista as etapas do processo, elas foram divididas entre três agentes, sendo eles:

\begin{itemize}
	\item Um agente de gerenciamento encarregado de trabalhar sobre os \textit{clusters}, mapeando VMs a servidores específicos e realizando a migração de VMs para viabilizar o gerenciamento, marcando os \textit{clusters} como trabalhados ao terminar as operações sobre eles;
	\item Um agente de registro encarregado de buscar os \textit{clusters} que serão gerenciados e marcá-los como sendo trabalhados;
	%\item Um gerente de alocação encarregado de tomar decisões realativas a alocação de novas VMs como onde alocá-las e a necessidade ou não de ativar recursos desligados;
	\item Um agente de alocação encarregado de verificar a necessidade de disponibilizar novos recursos.
\end{itemize}

\subsection{AGENTE DE GERENCIAMENTO}

O agente de gerenciamento tem o objetivo de operar sobre os \textit{clusters} do ambiente após eles serem registrados pelo agente de registro, isto é, realizar as operações de gerenciamento quando forem cabíveis. Como mostrado na figura \ref{fig:gerente-consolidacao}, irá solicitar um \textit{cluster} ao agente de registro para avaliar e determinar as possibilidades relativas ao seu gerenciamento baseado em heurísticas que devem ser especificadas pelo usuário do sistema. O agente de gerenciamento então opera sobre o \textit{cluster}, marcando-o como trabalhado por um tempo determinado pelo usuário, asssim que todas as possibilidades de gerenciamento forem efetuadas. Uma vez que todos os \textit{clusters} estão marcados como trabalhados, o agente de gerenciamento entra em estado de espera, e será notificado pelo agente de registro quando ocorrer a expiração do tempo de validade de alguma marcação.

A figura \ref{fig:legenda-agentes} contém uma legenda válida para todos os diagramas de agentes que serão apresentados a seguir, explicitando o significado dos elementos dos diagramas.

\begin{figure}[!htb]
	\centering
	\caption{Legenda relativa aos diagramas dos modelos de agentes.}\label{fig:legenda-agentes}
	\includegraphics[width=1\textwidth]{figuras/legenda-agentes.png}
\end{figure}

\begin{figure}[!htb]
	\centering
	\caption{Modelo do Agente de Gerenciamento.}\label{fig:gerente-consolidacao}
	\includegraphics[scale=0.45]{figuras/gerente-consolidacao.png}
\end{figure}

\subsection{AGENTE DE REGISTRO}

O agente de registro é o responsável por buscar os \textit{clusters} requisitados pelo agente de gerenciamento. Como explicitado nas figuras \ref{fig:agente-registro1} e \ref{fig:agente-registro2}, ao receber a mensagem do agente de gerenciamento solicitando um \emph{cluster} para ser trabalhado, o agente de registro determina qual \textit{cluster} deve ser avaliado, novamente baseado em heurísticas especificadas pelo usuário, encaminha uma mensagem ao agente de gerenciamento solicitando a operação sobre esse \textit{cluster} e registra o mesmo como sendo trabalhado. O agente de registro tem também a função de monitorar o \textit{timeout} das marcações realizadas pelo agente de gerenciamento. Uma vez que uma das marcações expira, uma nova mensagem é encaminhada ao agente de gerenciamento da mesma forma como foi encaminhada a primeira, solicitando uma nova operação sobre o \textit{cluster} que havia sido marcado.

\begin{figure}[!htb]
	\centering
	\caption{Modelo do Agente de Consolidação - Registro de Clusters.}\label{fig:agente-registro1}
	\includegraphics[width=1\textwidth]{figuras/agente-registro1.png}
\end{figure}

\begin{figure}[!htb]
	\centering
	\caption{Modelo do Agente de Consolidação - Delegação de Trabalho.}\label{fig:agente-registro2}
	\includegraphics[scale=0.40]{figuras/agente-registro2.png}
\end{figure}

\subsection{AGENTE DE ALOCAÇÃO}

O agente de alocação tem como objetivo manter a disponibilidade de recursos suficientes para o bom funcionamento do ambiente e é o responsável por verificar periodicamente a necessidade de disponibilizar recursos e realizar as operações relacionadas à alocação de novas VMs. Ao ser instanciado, é estabelecido um intervalo de tempo entre verificações, ao final do qual o agente compara a quantidade de recursos sendo utilizados com a quantidade de recursos ativos e, baseado nas heurísticas do usuário, decide se devem ser alocados novos recursos e, sendo necessário, a quantidade a ser alocada. A figura \ref{fig:agente-alocacao} explicita o modelo do agente.

\begin{figure}[!htb]
	\centering
	\caption{Modelo do Agente de Alocação.}\label{fig:agente-alocacao}
	\includegraphics[scale=0.45]{figuras/agente-alocacao.png}
\end{figure}
