\section{AGENTES DO SISTEMA DE GERÊNCIA}\label{sec:agentes-plataforma}

Uma vez que o funcionamento da plataforma de SMA está garantido pelo componente de gerência, os agentes modelados na arquitetura correspondente já podem ser instanciados e começar a atuar no ambiente. A ferramenta de orquestração permite o sensoriamento do seu ambiente para seus nodos de gerência, fato este que garante aos agentes a capacidade de observar os recursos do ambiente.

Embora seja garantido aos agentes um ambiente para atuarem e uma arquitetura para estarem contidos, estes ainda precisam ser instanciados. Esse processo, na tecnologia JADE usada neste trabalho, deve ser feito em tempo de execução ou através de parâmetros na inicialização de um dado \textit{container}. No âmbito desta proposta ambos sistemas de inicialização dos agentes são empregados para garantir que tanto o componente de gerência de agentes quanto o restante da ferramenta de orquestração não precisem ativamente preocuparem-se com a inicialização dos agentes. Este tópico é discutido em detalhes na subseção de inicialização dos agentes, sendo seus componentes:

A modelagem dos agentes elaborados neste trabalho foi realizada utilizando a \textit{Prometheus Modeling Tool} que utiliza a notação apresentada na Figura \ref{fig:legenda-agentes}:
\begin{figure}[!htb]
	\centering
	\caption{Legenda relativa aos diagramas dos modelos de agentes.}\label{fig:legenda-agentes}
	\includegraphics[width=1\textwidth]{figuras/legenda-agentes.png}
\end{figure}

\begin{itemize}
	\item Ação: Mecanismo que permite que o agente interaja com o ambiente em que se econtra. Pode representar funções atuadoras ou interações com artefatos;
	\item Capacidade: Abstração de uma funcionalidade do sistema. É composta por planos, eventos do ambiente e dados;
	\item Dados: Representação de um item ou estrutura de dados utilizado pelo sistema.;
	\item Mensagem: Mensagem trocada entre agentes;
	\item Plano: Sequência de eventos e ações que resultam na execução de um objetivo;
	\item Percepção: Informação oriunda de algum ponto do ambiente que pode ser interpretada pelo agente.
\end{itemize}

\subsection{Inicialização dos Agentes}

Para que a plataforma de SMA instanciada possa funcionar corretamente, além de ter seu ciclo de vida garantido, ela deve poder garantir o ciclo de vida de seus agentes. A própria plataforma é capaz de garantir que os agentes contidos dentro de um \textit{container} executarão enquanto este existir. No entanto, é necessário prever o caso onde um desses nodos apresente falhas e precise ser desalocado. Dada a incapacidade da plataforma de se reinstanciar, é de responsabilidade de algum componente faze-lo. Além disso, essa garantia de ciclo de vida para os agentes não deve violar a modularidade do gerente de SMA em relação ao restante da plataforma. Sendo assim, é responsabilidade do gerente garantir a criação e execução correta dos agentes. Para inspecionar os agentes da plataforma e decidir se são ainda necessários na plataforma, se estão operando de maneira correta e com as heurísticas que devem, um novo componente deve ser adicionado ao modelo.

De acordo com o projeto de acoplamento entre plataforma e a ferramenta de orquestração, ambos não conhecem a existência um do outro. Deste modo, a ferramenta de orquestração não consegue exprimir sua necessidade de um agente ou sociedade de agentes para a plataforma de SMA. O componente mencionado anteriormente tem não só a responsabilidade de instanciar agentes, mas também de representar as necessidades da ferramenta de orquestração em relação aos agentes e a quantidade destes que precisam estar ativos no ambiente orquestrado dependendo de seu estado. Para que essa tarefa seja executada, este componente deve sensoriar o ambiente e atuar nele de forma a atingir seu objetivo. Devido as características de suas ações e seu objetivo, este componente é modelado na forma de um agente deliberativo, chamado de agente inspetor da plataforma.

Para fins deste trabalho, o agente inspetor é responsável apenas por instânciar os agentes oriundos de \citeonline{gabriel}. Estes são detalhados nesta seção e são:

\begin{enumerate}
	\item Agente de busca de cluster: responsável por monitorar o ambiente de CN e listar os \textit{clusters} que precisam ser trabalhados;
	\item Agente diligente do cluster: tem a função de aplicar uma heurística de gerenciamento sobre os \textit{clusters} que são marcados para serem trabalhados;
	\item Agente de ativação de recursos: é o componente responsável por ligar \textit{hosts} desligados previamente para que possa atender a demandas crescentes.
\end{enumerate}

Estas três classes de agentes compõem a sociedade cujo o agente inspetor conhece. De forma a derivar os requisitos da ferramenta de orquestração, é disponibilizado um artefato através do qual a ferramenta disponibiliza suas necessidades em alto nível. Sendo assim, o inspetor pode derivar que classes de agentes serão necessários para alcançar estes objetivos e a quantidade de instâncias através de seus conhecimentos sobre os agentes.

\subsubsection{Agente Inspetor da Plataforma}\label{subsec:supervisor}

O agente inspetor da plataforma deve existir enquanto houver uma instância da arquitetura de SMA ativa. Dada essa característica, este inspetor é inicializado junto aos \textit{main containers} da plataforma através de parâmetros na inicialização dessa. Deste modo, o agente inspetor possui seu próprio ciclo de vida garantido pelo fato de que os nodos principais da plataforma contém redundância, mantendo-se ativos com cópias para atuar como nodo principal na falha do \textit{main container} corrente. O inspetor da plataforma tem como responsabilidade tanto instânciar os agentes para efetuarem a gerência do ambiente de computação em nuvem, quanto realizar o processo de gerenciamento destes. Caso seja notado que um determinado agente não seja mais necessário, é responsabilidade do inspetor terminar sua execução.

Deve-se notar que um agente responsável por analisar as necessidades de um ambiente de computação em nuvem e instanciar todos os agentes requisitados, pode ficar complexo e demonstrar baixa escalabilidade. Uma resposta a esse fenômeno é especializar o inspetor para que cada especialização expresse uma necessidade específica da ferramenta de orquestração e sua utilidade seja gerenciar apenas a sociedade de agentes necessária para suprir essa demanda específica, mantendo a inicialização destes junto dos \textit{main containers}. Embora não seja o objetivo deste trabalho lidar com este problema específico, essa observação se faz necessária pois pode tornar-se um problema em ambientes que desejam delegar muitas funções de gerência para o SMA.

A intenção do agente inspetor da plataforma é fazer com que a ferramenta de orquestração tenha todo os agentes que deseja ativos até que a necessidade de gerência desta mude. É cargo deste agente sensoriar tanto ambiente da plataforma de SMA quanto obter informações sobre os requisitos de gerência da ferramenta de orquestração. O cruzamento desses dados é responsável por gerar as principais crenças deste agente, que motivado por elas deve adotar um plano para concretizar sua intenção. Este agente é bem definido dentro de um modelo cognitivo e intencional, onde precisa tomar decisões e manter um estado interno composto de crenças referentes a como seu ambiente encontra-se em um dado momento, deliberando sobre suas percepções e vontades.

Sendo esse o único agente de meta gerência, seus objetivos diferem do restante da sociedade em relação ao domínio de sua atuação (único agente que sensoria e tem suas ações direcionadas a própria plataforma de SMA). Para simplificar a visualização do restante da sociedade de agentes, este agente é modelado de forma separada (como um sistema disjunto do restante da sociedade de agentes), de modo que todas as atribuições, percepções e funcionalidades desse sub-sistema competem a ele apenas. Seguindo a metodologia \textit{Prometheus}, baseada em teoria de agentes, podemos decompor este sistema em funcionalidades, percepções, objetivos, ações e protocolos de comunicação, conforme apresentado em \cite{prometheus}.

Os eventos trazem informações diretas e completas para o agente, o qual consegue deliberar sobre as implicações diretas de seus acontecimentos. As percepções, no entanto, precisam ser analisadas e ponderadas \cite{prometheus}. Sendo assim os eventos e percepções relacionados com esse agente são os que seguem:

\begin{enumerate}
	\item Evento da destruição de \textit{container}: ocorre quando um nodo da plataforma é destruido, terminando ações de agentes que lá residiam;
	\item Evento de criação de \textit{container}: ocorre quando um novo nodo da plataforma é criado, podendo conter novos agentes;
	\item Percepção de mudança nas necessidades do sistema: ocorre ao ser percebido que a ferramenta de orquestração mudou suas heurísticas;
	\item Percepção de ócio: percebido quando a tarefa executada por um grupo de agentes está usando mais recursos do que precisa para sua completude;
	\item Percepção de subdesempenho: percebido quando uma tarefa executada por um grupo de agentes não está tendo sucesso de se concluir em uma taxa desejada.
\end{enumerate}

A destruição de um container o informa diretamente quantos e quais agentes deixaram a sociedade através de um simples acesso aos dados sobre ela. A criação de um container deve ser percebida também, pois pode haver o caso em que os nodos correntes estão lotados de agentes (sobrecarregando uma VM de sistema) e deve-se esperar até que haja algum local disponível para criá-los. As percepções de ócio e subdesempenho devem ser processadas para analisar se constitui-se mesmo de ócio ou subdesempenho de agentes, ou trata-se apenas de discrepâncias ou casos especiais. Por fim, as mudanças nas necessidades do sistema devem ser interpretadas afim de decidir se alguma estratégia deve mudar para conseguir atingir seus requisitos.

As ações do inspetor são listadas a seguir:

\begin{enumerate}
	\item Destruir um agente: terminar a execução de um agente de algum dado tipo;
	\item Criar um agente: inicializar um agente dentro da plataforma de SMA;
	\item Interpretar necessidades da ferramenta de orquestração: deriva um modelo de requisitos para ser implementado pelo inspetor sobre a vontade da ferramenta de orquestração;
	\item Verificar espaço para novos agentes: confere se há local para criar novos agentes no ambiente ou se a plataforma está lotada;
	\item Analisar tempo de execução de tarefa: mede o tempo que uma atividade está demorando para ser realizada;
\end{enumerate}

As ações do inspetor de destruição e criação de agentes ainda podem ser granularizadas para cada tipo específico de agente, gerando um total de 8 ações possíveis. Estas em conjunto com as percepções e eventos relativos a este agente, são mescladas para formar a sua única funcionalidades (papel): implementar as necessidades da ferramenta de orquestração. Essa funcionalidade engloba todas as ações e percepções citadas previamente e implementa os requisitos registrados pela ferramenta de orquestração.

Para que possa obter informações sobre os agentes que compõem a sociedade, o inspetor precisa conhecer os agentes e ter acesso a eles. Para que ele consiga deliberar sobre o estado em que a sociedade de agentes se encontra em um dado momento, o inspetor pode usar do agente FIPA AMS (\textit{Agent Management System}) para que possa descobrir os agentes registrados e ativos na plataforma. Caracteriza-se assim o único ato social deste agente, que se faz necessário para que possa perceber o ambiente em que os agentes estão inseridos. Por consequência disso, uma nova ação com o objetivo de descobrir os agentes ativos deve ser criada e delegada ao AMS. A Figura \ref{fig:agente-inspetor} demonstra o documento chamado de \textit{system overview} da metodologia \textit{prometheus} para este sistema.

\begin{figure}[!htb]
	\centering
	\caption{\textit{system overview diagram} referente ao agente inspetor da plataforma.}\label{fig:agente-inspetor}
	\includegraphics[width=1\textwidth]{figuras/agente_inspetor.png}
\end{figure}

Ao perceber a destruição de um container o inspetor verifica se este possuía agentes os quais podem se fazer necessários na condição atual de desempenho do sistema. Caso seja confirmada a necessidade dos agentes ele irá recriá-los se houver espaço na plataforma de SMA. Se nenhum nodo poder receber mais agentes, o inspetor espera pela criação de um novo \textit{container}, que ocorrerá no próximo ciclo de execução do gerente de plataforma. Dessa forma, o agente será criado quando o inspetor perceber este evento. Caso seja notado ócio ou subdesempenho de agentes da sociedade, o inspetor deve verificar o tempo de execução das tarefas e procurar por discrepâncias antes de decidir criar ou destruir novos agentes. Assim se for notado que o tempo apresenta poucas variações, porém mantém-se o ócio ou subdesempenho, pode-se inferir que faltam ou sobram agentes na sociedade para realizar a tarefa e medidas cabíveis devem ser tomadas (criação ou destruição de agentes). Se for detectado que as necessidades da ferramenta de orquestração mudaram, elas devem ser interpretadas pelo inspetor, que deve verificar e ajustar a sociedade de agentes para suprir a nova demanda, se necessário. Caracteriza-se assim o agente inspetor, garantindo que o restante dos agentes possam trabalhar no ambiente de CN sem se preocuparem com a garantia de seu ciclo de vida ou heurísticas de desempenho.


\subsection{MODELO DOS AGENTES DE GERÊNCIA DO AMBIENTE DE NUVEM}

Nesta seção serão descritos os modelos dos três agentes responsáveis por implementar as funções propostas por \citeonline{gabriel}.

\subsubsection{Agente de Busca do Cluster}

O agente de busca de \textit{cluster} é um agente reativo, segundo a definição proposta em \citeonline{wooldridge1995intelligent}, que classifica uma arquitetura de agente como reativa quando este não possui um modelo simbólico do mundo a sua volta e não faz uso de nenhum tipo de raciocínio simbólico. O agente tem o objetivo de monitorar o ambiente a procura de \textit{clusters} que necessitam ser trabalhados, para então apresentá-los de forma que o agente diligente possa trabalhar sobre os \textit{clusters}. Essa listagem é feita através de um \textit{blackboard}, instanciado na plataforma JADE. Como ilustrado na Figura \ref{fig:agente-alistamento}, o agente de busca terá conhecimento apenas dos \textit{clusters} ativos do ambiente e, uma vez que um novo \textit{cluster} for descoberto ou algum \textit{cluster} existente tiver sido trabalhado pela última vez a muito tempo, ele deve escrever no \textit{blackboard} a necessidade de trabalhar novamente sobre aquele \textit{cluster}.

\begin{figure}[!htb]
	\centering
	\caption{Modelo do agente de busca de cluster.}\label{fig:agente-alistamento}
	\includegraphics[scale=0.40]{figuras/agente-alistamento.png}
\end{figure}

O intervalo de gerenciamento é estabelecido pelo agente diligente uma vez que ele trabalha sobre um \textit{cluster}. Este intervalo serve como uma forma de assegurar que o trabalho sobre os \textit{clusters} seja realizado novamente apenas após um tempo estabelecido pelo administrador, já que a realização contínua de trabalho sobre os \textit{clusters} traria consigo um alto custo computacional com benefícios aquém dos necessários para compensar tal custo, sendo que poucas operações de alocação ou liberação de recursos seriam realizadas em um pequeno espaço de tempo.

\subsubsection{Agente Diligente do Cluster}\label{subsec:agente_diligente}

O agente diligente do \textit{cluster} é outro agente reativo segundo \citeonline{wooldridge1995intelligent}. O agente é responsável por realizar os processos de gerência nos \textit{clusters} que foram identificados como aptos para receber tais processos. Ao verificar o \textit{blackboard} a procura de novos \textit{clusters} para trabalhar, o agente passa a ter uma lista dos \textit{clusters} sobre os quais deve aplicar as operações de gerência.

Tendo \textit{clusters} listados, o agente deve aplicar as heurísticas definidas pelo administrador do ambiente para determinar a prioridade para a realização do trabalho sobre os seus \textit{hosts}. Uma vez definida a prioridade dos \textit{hosts} a serem trabalhados, o agente diligente solicita, em ordem, que as \textit{VMs} dos \textit{hosts} de menor prioridade sejam mapeados aos \textit{hosts} de maior prioridade, na medida em que estes possuírem recursos suficientes disponíveis. Uma vez que um \textit{host} não possui mais \textit{VMs} mapeadas a ele, este \textit{host} pode ser desativado. Como explicitado na Figura \ref{fig:agente-diligente}, o agente espera o término do trabalho para poder marcar o \textit{cluster} como trabalhado por um tempo determinado pelo administrador e atuar sobre o próximo \textit{cluster}.

\begin{figure}[!htb]
	\centering
	\caption{Modelo do agente diligente do cluster.}\label{fig:agente-diligente}
	\includegraphics[width=1\textwidth]{figuras/agente-diligente.png}
\end{figure}

\subsubsection{Agente de Ativação de Recursos}

O agente de ativação de recursos é um agente reativo, seguindo a mesma definição de reatividade apresentada na definição do agente de busca, que tem como objetivo manter a disponibilidade de recursos suficientes para o bom funcionamento do ambiente, sendo o responsável por verificar periodicamente a necessidade de disponibilizar mais recursos físicos para o ambiente. Ele é o responsável pela ativação de \textit{hosts} que podem vir a serem desativados. Ao ser instanciado, é estabelecido um intervalo de tempo entre verificações, ao final do qual o agente compara a quantidade de recursos sendo utilizados com a quantidade de recursos ativos e, baseado nas heurísticas, decide se devem ser ativados novos recursos e, sendo necessário, a quantidade a ser ativada. A Figura \ref{fig:agente-alocacao} explicita o modelo do agente.

\begin{figure}[!htb]
	\centering
	\caption{Modelo do agente de alocação.}\label{fig:agente-alocacao}
	\includegraphics[scale=0.45]{figuras/agente-alocacao.png}
\end{figure}

Vale notar que o agente de ativação, por conta própria, não consegue garantir integralmente a disponibilidade de recursos físicos, já que podem haver casos de uma demanda inesperada por recursos enquanto o intervalo de verificação ainda estiver correndo. Para remediar estas situações, um gerente de recursos é injetado na plataforma de orquestração do ambiente extendida por \cite{gabriel}, e atua sob demanda para disponibilizar recursos físicos, quando for tentada a alocação de uma \textit{VM} e não forem encontrados recursos suficientes.
